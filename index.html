<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f3f3f3;
            font-family: Arial, sans-serif;
        }
        #password {
            margin-top: 20px;
            font-size: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div>
        <button onclick="generatePassword()">Generate</button>
        <p id="password"></p>
    </div>

    <script>
    var words = [];
    var symbols = ["!", "@", "#", "$", "%", "&", "*", "(", ")", " ", ",", ".", "-", "_"];
    var numbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];

    // Fetch word list from the URL and store it in the words array
    fetch('/wordlist/words.txt')
       .then((response) => response.text())
       .then((text) => {
			words = text.split('\n');
       });


    function getRandomElement(arr) {
        return arr[Math.floor(Math.random() * arr.length)];
    }

    function convertToLeet(password) {
        const vowels = ["a", "e", "i", "o", "u"];
        const leet = {"a": "4", "e": "3", "i": "1", "o": "0"};
        var vowelCount = {"a": 0, "e": 0, "i": 0, "o": 0, "u": 0};
        var mostCommonVowel = "a";

        // count the occurrences of each vowel
        for (let i = 0; i < password.length; i++) {
            let char = password[i].toLowerCase();
            if (vowels.includes(char)) {
                vowelCount[char]++;
                if (vowelCount[char] > vowelCount[mostCommonVowel]) {
                    mostCommonVowel = char;
                }
            }
        }

        // if the most common vowel has a leet equivalent, replace it
        if (leet[mostCommonVowel]) {
            let regex = new RegExp(mostCommonVowel, "gi");
            password = password.replace(regex, leet[mostCommonVowel]);
        }

        return password;
    }

    // generates random seperator to go between words to make dictionary attack more difficult
	// increase seperator length will be more secure but harder to remember
	function generateSeparator() {
        var separator = '';
        var numberOfSeparators = Math.floor(Math.random() * 2) + 1;
        var symbolOrNumber = [symbols, numbers];

        for (var i = 0; i < numberOfSeparators; i++) {
            var arr = getRandomElement(symbolOrNumber);
            separator += getRandomElement(arr);
        }

        return separator;
    }

    function generatePassword() {
        var word1 = getRandomElement(words);
        var word2 = getRandomElement(words);
        var word3 = getRandomElement(words);
        var separator1 = generateSeparator();
        var separator2 = generateSeparator();

		// Adjust to modify how the password is constructed
        var password = word1 + separator1 + word2 + separator2 + word3;

        // If password length doesn't meet the criteria, regenerate
        if (password.length > 30 || password.length < 15) {
            return generatePassword();
        }

        password = convertToLeet(password);
        
        document.getElementById("password").textContent = password;
    }
</script>
</body>
</html>
